<!DOCTYPE html>
<html>

<head>
    <title>Add Map</title>
    <!-- <script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script> -->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <style>
        #map {
            height: 400px;
            /* The height is 400 pixels */
            width: 100%;
        }
        
        #place_input,
        #place_origin,
        #place_destination,
        #distance_km {
            width: 100%;
            height: 40px;
            border-radius: 0;
        }
    </style>
    <script type="module" src="./home.js"></script>
</head>

<body>
    <h3>Tratando de calcular Distancias</h3>
    <!--The div element for the map -->
    <input type="text" id="place_input" placeholder="Ingrese una Ubicación">
    <div id="map"></div>

    <input type="text" id="place_origin" placeholder="Ubicación Origen">
    <input type="text" id="place_destination" placeholder="Ubicación Destino">
    <button id="btn_calculo_distancia">Calcular</button>
    <input type="text" id="distance_km" placeholder="Distancia entre las ubicaciones">

    <!-- <script async src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCNlsS5ZWXx_l8kzgjGyRRZ8uJ0YodeYyE&libraries=places&callback=initMap"></script> -->
    <script async src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCNlsS5ZWXx_l8kzgjGyRRZ8uJ0YodeYyE&libraries=places&callback=initAutoCompleteDistance"></script>
    <!-- <script src="./home.js"></script> -->
    <script>
        const mapDiv = document.getElementById("map"),
            input_place = document.getElementById("place_input"),
            input_place_origin = document.getElementById("place_origin"),
            input_place_destination = document.getElementById("place_destination"),
            input_place_distance = document.getElementById("distance_km"),
            btn_calculo_distancia = document.getElementById("btn_calculo_distancia"),
            argCoords = {
                lat: -34.0,
                lng: -64.0
            };
        let map,
            marker,
            autocompleteOrigin,
            autocompleteDestination;

        function initMap() {
            map = new google.maps.Map(mapDiv, {
                center: argCoords,
                zoom: 5,
            })
            marker = new google.maps.Marker({
                position: argCoords,
                map: map,
            });
            initAutoComplete();
        }

        function initAutoComplete() {
            autocomplete = new google.maps.places.Autocomplete(input_place);
            autocomplete.addListener('place_changed', function() {
                const place = autocomplete.getPlace();
                console.log(place);
                /* map.setCenter(place.geometry.location);
                marker.setPosition(place.geometry.location) */
            })
        }





        /* function calculateDistance() {
            initAutoCompleteDistance

        }
 */


        let placeID_Origen,
            placeID_destino;

        function initAutoCompleteDistance() {
            autocompleteOrigin = new google.maps.places.Autocomplete(input_place_origin);
            autocompleteDestination = new google.maps.places.Autocomplete(input_place_destination);
            autocompleteOrigin.addListener('place_changed', function() {
                const placeOrigin = autocompleteOrigin.getPlace();
                console.log(placeOrigin);
                //console.log(placeOrigin.place_id);
                placeID_Origen = placeOrigin.place_id
                console.log(placeID_Origen);
                /* map.setCenter(place.geometry.location);*/
                //marker.setPosition(placeOrigin.geometry.location) 

            });
            autocompleteDestination.addListener('place_changed', function() {
                const placeDestination = autocompleteDestination.getPlace();
                console.log(placeDestination);
                //placeID_destino = placeDestination.place_id;
                placeID_destino = placeDestination.place_id
                    /* map.setCenter(place.geometry.location);
                    marker.setPosition(place.geometry.location) */
            })
        }


        btn_calculo_distancia.addEventListener("click", (event) => {
            event.preventDefault();
            console.log(placeID_Origen, placeID_destino);
            const config = {
                method: 'get',
                url: `https://maps.googleapis.com/maps/api/distancematrix/json?origins=place_id:${placeID_Origen}&destinations=place_id:${placeID_destino}&key=AIzaSyCNlsS5ZWXx_l8kzgjGyRRZ8uJ0YodeYyE`,
            };

            axios(config)
                .then(function(response) {
                    //console.log(JSON.stringify(response.data));
                    let data = JSON.stringify(response.data);
                    //console.log(data);
                    console.log(JSON.parse(data));
                    let datos = JSON.parse(data);
                    console.log("datos", datos);
                    console.log("datos.destination_addresses", datos.destination_addresses);
                })
                .catch(function(error) {
                    console.log(error);
                });
            /* fetch(`https://maps.googleapis.com/maps/api/distancematrix/json?origins=40.6655101%2C-73.89188969999998&destinations=40.659569%2C-73.933783%7C&key=AIzaSyCNlsS5ZWXx_l8kzgjGyRRZ8uJ0YodeYyE`, {
                    method: 'GET',

                    headers: {
                        Accept: 'application/json',
                        mode: "cors",
                    },


                })
                .then(res => res.json())
                .then(data => {
                    console.log("resp google API:", data);
                })
                .catch(function(error) {
                    console.log(error);
                }); */

        })
    </script>
    <!-- <script>
        const config = {
            method: 'get',
            url: 'https://maps.googleapis.com/maps/api/distancematrix/json?origins=40.6655101%2C-73.89188969999998&destinations=40.659569%2C-73.933783%7C&key=AIzaSyCNlsS5ZWXx_l8kzgjGyRRZ8uJ0YodeYyE',
        };

        axios(config)
            .then(function(response) {
                console.log(JSON.stringify(response.data));
            })
            .catch(function(error) {
                console.log(error);
            });
    </script> -->
</body>

</html>