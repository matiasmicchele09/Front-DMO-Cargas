<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Agregar Cargas - DMO Cargas</title>
    <base href="/">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <link rel="stylesheet" href="./assets/normalize.css">
    <link rel="stylesheet" href="./assets/libs/bootstrap-5.2.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="./assets/styles.css">
    <script src="https://kit.fontawesome.com/a40ecc8ef9.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>

<body>
    <nav class="navbar navbar-expand-lg navbar-navigation">
        <!--navbar-navigation la cree yo, esta en styles.css-->
        <div class="container-fluid">
            <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                <li class="nav-item mt-1">
                    <p class="parr_volver"><i class="fa-solid fa-circle-left"></i><a class="nav-link d-inline" style="margin-left: 10px; color: #241F74;">Volver</a></p>
                </li>
            </ul>
        </div>
    </nav>

    <div class="container add_freights">
        <form class="formulario_freight" autocomplete="off" id="form_freight">

            <!-- Grupo: Usuario -->
            <div class="formulario_grupo d-none" id="grupo__cod_usuario">
                <!--  hidden="true" para el grupo de usuario -->
                <label for="cod_usuario" class="form__label">Usuario</label>
                <div class="form__grupo_input">
                    <input type="text" class="form__input form-control" id="cod_usuario" name="cod_usuario">
                </div>
            </div>

            <!-- Grupo: Tipo Carga -->
            <div class="formulario_grupo d-none" id="grupo__cod_tipo_carga">
                <label for="cod_tipo_carga" class="form__label">Tipo Carga</label>
                <div class="form__grupo_input">
                    <input type="text" class="form__input form-control" id="cod_tipo_carga" name="cod_tipo_carga">
                </div>
            </div>

            <!-- Grupo: Origen -->
            <div class="formulario_grupo" id="grupo__origen" style="display: inline-block;">
                <label for="origen" class="form__label">Origen</label>
                <div class="form__grupo_input">
                    <!-- <input type="text" placeholder="Origen" class="form__input form-control" id="ciudad_origen" name="ciudad_origen"> -->
                    <input type="text" placeholder="Ubicación Origen" class="form__input form-control" id="origen" name="origen">
                    <i class="form__validacion_estado fa-solid fa-circle-xmark"></i>
                </div>
                <p class="form__input_error">La Ciudad solo acepta letras</p>
            </div>

            <!-- Grupo: Domicilio Origen -->
            <div class="formulario_grupo" id="grupo__domicilio_origen" style="display: inline-block;">
                <label for="domicilio_origen" class="form__label">Domicilio</label>
                <div class="form__grupo_input">
                    <input type="text" placeholder="Calle + Número" class="form__input form-control" id="domicilio_origen" name="domicilio_origen">
                    <i class="form__validacion_estado fa-solid fa-circle-xmark"></i>
                </div>
                <p class="form__input_error">Debe ingresar primero la calle y luego el número</p>
            </div>

            <!-- Grupo: Fecha Retiro -->
            <div class="formulario_grupo" id="grupo__fec_retiro" style="display: inline-block;">
                <label for="fec_retiro" class="form__label">Fecha Retiro</label>
                <div class="form__grupo_input">
                    <input type="date" class="form__input form-control" id="fec_retiro" name="fec_retiro">
                </div>
                <p class="form__input_error">Debe ingresar una Fecha</p>
            </div>

            <!-- Grupo: Hora Retiro -->
            <div class="formulario_grupo" id="grupo__hora_retiro" style="display: inline-block;">
                <!--El name es para JS, class para CSS el, el id para JS y tbm para el label for-->
                <label for="hora_retiro" class="form__label">Hora Retiro</label>
                <div class="form__grupo_input">
                    <input type="time" class="form__input form-control" id="hora_retiro" name="hora_retiro">
                </div>
                <p class="form__input_error">Debe ingresar una Hora</p>
            </div>
            <hr>

            <!-- Grupo: Destino -->
            <div class="formulario_grupo" id="grupo__destino" style="display: inline-block;">
                <label for="destino" class="form__label">Destino</label>
                <div class="form__grupo_input">
                    <input type="text" placeholder="Ubicación Destino" class="form__input form-control" id="destino" name="destino">
                    <i class="form__validacion_estado fa-solid fa-circle-xmark"></i>
                </div>
                <p class="form__input_error">La Ciudad solo acepta letras</p>
            </div>

            <!-- Grupo: Domicilio Destino -->
            <div class="formulario_grupo" id="grupo__domicilio_destino" style="display: inline-block;">
                <label for="domicilio_destino" class="form__label">Domicilio</label>
                <div class="form__grupo_input">
                    <input type="text" placeholder="Calle + Número" class="form__input form-control" id="domicilio_destino" name="domicilio_destino">
                    <i class="form__validacion_estado fa-solid fa-circle-xmark"></i>
                </div>
                <p class="form__input_error">Debe ingresar primero la calle y luego el número</p>
            </div>

            <!-- Grupo: Receptor de Carga -->
            <div class="formulario_grupo" id="grupo__receptor_carga" style="display: inline-block;">
                <label for="receptor_carga" class="form__label">Receptor</label>
                <div class="form__grupo_input">
                    <input type="text" placeholder="Quién reciba la carga" class="form__input form-control" id="receptor_carga" name="receptor_carga">
                    <i class="form__validacion_estado fa-solid fa-circle-xmark"></i>
                </div>
                <p class="form__input_error">Debe ingresar un Receptor de la Carga</p>
            </div>

            <!-- Grupo: Fecha Llegada -->
            <div class="formulario_grupo" id="grupo__fec_destino" style="display: inline-block;">
                <!--El name es para JS, class para CSS el, el id para JS y tbm para el label for-->
                <label for="fec_destino" class="form__label">Fecha Llegada</label>
                <div class="form__grupo_input">
                    <input type="date" class="form__input form-control" id="fec_destino" name="fec_destino">
                </div>
                <p class="form__input_error">Debe ingresar una Fecha</p>
            </div>

            <!-- Grupo: Hora Llegada -->
            <div class="formulario_grupo" id="grupo__hora_destino" style="display: inline-block;">
                <label for="hora_destino" class="form__label">Hora Llegada</label>
                <div class="form__grupo_input">
                    <input type="time" class="form__input form-control" id="hora_destino" name="hora_destino">
                </div>
                <p class="form__input_error">Debe ingresar una Hora</p>
            </div>
            <hr>
            <!-- Grupo: Comentario -->
            <div class="formulario_grupo" id="grupo__comentario" style="grid-column: span 3;">
                <label for="comentario" class="form__label">Comentario</label>
                <div class="form__grupo_input">
                    <input type="text" placeholder="Opcional" class="form__input form-control" id="comentario" name="comentario">
                </div>
            </div>

            <!-- Grupo: Estado -->
            <div class="formulario_grupo" id="" style="grid-column: span 3;">
                <label for="selectEstadoCarga" class="form__label">Estado</label>
                <div class="form__grupo_input">
                    <select class="selectTipoProducto" name="cod_estado_carga" id="selectEstadoCarga">                        
                        <!-- <option id="" value="0">Seleccione el estado...</option> -->
                    </select>
                </div>
            </div>
            <!-- Grupo: Tipo Producto -->
            <div class="formulario_grupo" id="" style="grid-column: span 3;">
                <label for="selectTipoProducto" class="form__label">Tipo Producto</label>
                <div class="form__grupo_input">
                    <select class="selectTipoProducto" name="cod_tipo_producto" id="selectTipoProducto">
                        <option id="option_tipo_prod_0" value="0">Seleccione un producto...</option>
                    </select>
                </div>
            </div>

            <!-- Grupo: Req. Refrigeracion -->
            <div class="formulario_grupo form_req_refrigeracion" id="grupo__req_refrigeracion">
                <label for="" class="form__label">                
                    <input type="checkbox" value="true" id="req_refrigeracion" name="req_refrigeracion"> Requiere Refrigeración
                </label>
            </div>

            <!-- Grupo: Carga Peligrosa -->
            <div class="formulario_grupo form_es_carga_peligrosa" id="grupo__es_carga_peligrosa">
                <label for="" class="form__label">                
                    <input type="checkbox" value="true" id="es_carga_peligrosa" name="es_carga_peligrosa"> Carga Peligrosa
                </label>
            </div>

            <!-- Grupo: Carga Apilable -->
            <div class="formulario_grupo form_es_carga_apilable" id="grupo__es_carga_apilable">
                <label for="" class="form__label">                
                    <input type="checkbox" value="true" id="es_carga_apilable" name="es_carga_apilable"> Carga Apilable
                </label>
            </div>

            <!-- Grupo: Cant. Unitaria -->
            <div class="formulario_grupo form_cant_unit" id="grupo__cant_unit">
                <label for="cant_unit" class="form__label">Cant. Unitaria</label>
                <div class="form__grupo_input">
                    <input type="text" placeholder="En Unidades" class="form__input form-control" id="cant_unit" name="cant_unit">
                    <i class="form__validacion_estado fa-solid fa-circle-xmark"></i>
                </div>
                <p class="form__input_error">La Cantidad solo debe contener números</p>
            </div>

            <!-- Grupo: Peso Unitario KG -->
            <div class="formulario_grupo form_peso_unit_kg" id="grupo__peso_unit_kg">
                <label for="peso_unit_kg" class="form__label">Peso Unitario</label>
                <div class="form__grupo_input">
                    <input type="text" placeholder="En Kg" class="form__input form-control" id="peso_unit_kg" name="peso_unit_kg">
                    <i class="form__validacion_estado fa-solid fa-circle-xmark"></i>
                </div>
                <p class="form__input_error">El Peso solo debe contener números</p>
            </div>

            <!-- Grupo: Peso Total KG -->
            <div class="formulario_grupo form_peso_total_kg" id="grupo__peso_total_kg">
                <label for="peso_total_kg" class="form__label">Peso Total</label>
                <div class="form__grupo_input">
                    <input type="text" placeholder="En Kg" class="form__input form-control" id="peso_total_kg" name="peso_total_kg">
                    <i class="form__validacion_estado fa-solid fa-circle-xmark"></i>
                </div>
                <p class="form__input_error">El Peso solo debe contener números</p>
            </div>

            <!-- Grupo: Largo -->
            <div class="formulario_grupo form_largo_mts" id="grupo__largo_mts">
                <label for="largo_mts" class="form__label">Largo</label>
                <div class="form__grupo_input">
                    <input type="text" placeholder="En metros" class="form__input form-control" id="largo_mts" name="largo_mts">
                    <i class="form__validacion_estado fa-solid fa-circle-xmark"></i>
                </div>
                <p class="form__input_error">El Largo solo debe contener números</p>
            </div>

            <!-- Grupo: Ancho -->
            <div class="formulario_grupo form_ancho_mts" id="grupo__ancho_mts">
                <label for="ancho_mts" class="form__label">Ancho</label>
                <div class="form__grupo_input">
                    <input type="text" placeholder="En metros" class="form__input form-control" id="ancho_mts" name="ancho_mts">
                    <i class="form__validacion_estado fa-solid fa-circle-xmark"></i>
                </div>
                <p class="form__input_error">El Ancho solo debe contener números</p>
            </div>

            <!-- Grupo: Alto -->
            <div class="formulario_grupo form_alto_mts" id="grupo__alto_mts">
                <label for="alto_mts" class="form__label">Alto</label>
                <div class="form__grupo_input">
                    <input type="text" placeholder="En metros" class="form__input form-control" id="alto_mts" name="alto_mts">
                    <i class="form__validacion_estado fa-solid fa-circle-xmark"></i>
                </div>
                <p class="form__input_error">El Alto solo debe contener números</p>
            </div>

            <!-- Grupo: Peso Unitario TN -->
            <div class="formulario_grupo form_peso_unit_tn" id="grupo__peso_unit_tn">
                <label for="peso_unit_tn" class="form__label">Peso Unitario</label>
                <div class="form__grupo_input">
                    <input type="text" placeholder="En Tn" class="form__input form-control" id="peso_unit_tn" name="peso_unit_tn">
                    <i class="form__validacion_estado fa-solid fa-circle-xmark"></i>
                </div>
                <p class="form__input_error">El Peso solo debe contener números</p>
            </div>

            <!-- Grupo: Peso Total TN -->
            <div class="formulario_grupo form_peso_total_tn" id="grupo__peso_total_tn">
                <label for="peso_total_tn" class="form__label">Peso Total</label>
                <div class="form__grupo_input">
                    <input type="text" placeholder="En Tn" class="form__input form-control" id="peso_total_tn" name="peso_total_tn">
                    <i class="form__validacion_estado fa-solid fa-circle-xmark"></i>
                </div>
                <p class="form__input_error">El Peso solo debe contener números</p>
            </div>

            <!-- Grupo: Cant. Litros -->
            <div class="formulario_grupo form_cant_litros" id="grupo__cant_litros">
                <label for="cant_litros" class="form__label">Cantidad Litros</label>
                <div class="form__grupo_input">
                    <input type="text" placeholder="En Litros" class="form__input form-control" id="cant_litros" name="cant_litros">
                    <i class="form__validacion_estado fa-solid fa-circle-xmark"></i>
                </div>
                <p class="form__input_error">La cantidad solo debe contener números</p>
            </div>



            <div class="formulario_grupo form__grupo-btn-agregar-carga">
                <button class="btn_calcular_valor" id="btn_calcular_valor">Calcular Valor de la Carga</button>

                <div class="formulario_grupo form_valor_carga" id="grupo__valor_carga">
                    <label for="valor_carga" class="form__label">Valor Carga</label>
                    <div class="form__grupo_input">
                        <input type="text" class="form__input form-control" id="valor_carga" name="valor_carga" disabled>
                    </div>
                </div>

                <div class="form__mensaje_error" id="form__mensaje_error">
                    <p><i class="fa-solid fa-triangle-exclamation"></i> <b>Error:</b> Datos Incorrectos/Incompletos</p>
                </div>


                <button type="submit" name="" id="btn-agregaCarga" class="btn form_btn mt-3 mb-3 btn-agregaCarga">Agregar Carga</button>
            </div>
        </form>


    </div>
    <script src="./assets/libs/bootstrap-5.2.0/js/bootstrap.min.js "></script>
    <script src="./add_freight.js "></script>
    <script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script async src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCNlsS5ZWXx_l8kzgjGyRRZ8uJ0YodeYyE&libraries=places&callback=initAutoCompleteDistance"></script>
    <script>
        const input_place_origin = document.getElementById("origen"),
            input_place_destination = document.getElementById("destino"),
            btn_calcula_valor = document.getElementById("btn_calcular_valor"),
            input_valor_carga = document.getElementById("valor_carga"),
            valor_km_recorrido = 100,
            valor_unit_tn = 1500,
            valor_unit_kg = 1.5,
            valor_litro = 2000,
            selectProducto = document.getElementById("selectTipoProducto"),
            peso_total_kg = document.getElementById("peso_total_kg"),
            peso_total_tn = document.getElementById("peso_total_tn"),
            cant_litros = document.getElementById("cant_litros");

        let autocompleteOrigin,
            autocompleteDestination,
            placeID_Origen,
            placeID_destino;

        function initAutoCompleteDistance() {
            autocompleteOrigin = new google.maps.places.Autocomplete(input_place_origin);
            autocompleteDestination = new google.maps.places.Autocomplete(input_place_destination);
            autocompleteOrigin.addListener('place_changed', function() {
                const placeOrigin = autocompleteOrigin.getPlace();
                placeID_Origen = placeOrigin.place_id;
                //console.log(placeID_Origen);
            });
            autocompleteDestination.addListener('place_changed', function() {
                const placeDestination = autocompleteDestination.getPlace();
                placeID_destino = placeDestination.place_id;

            })
        }

        btn_calcula_valor.addEventListener("click", (event) => {
            event.preventDefault();
            const config = {
                method: 'get',
                url: `https://maps.googleapis.com/maps/api/distancematrix/json?origins=place_id:${placeID_Origen}&destinations=place_id:${placeID_destino}&key=AIzaSyCNlsS5ZWXx_l8kzgjGyRRZ8uJ0YodeYyE`,
            };

            if (selectProducto.value == 0) {
                alert("Debe elegir un Tipo de Producto")
            } else {
                if (peso_total_kg.value == "" || peso_total_tn.value == "" || cant_litros.value == "") {
                    alert("¡Datos Incorrectos/Incompletos!")
                } else {
                    axios(config)
                        .then(function(response) {
                            let data = JSON.stringify(response.data),
                                datos = JSON.parse(data);
                            console.log("datos", datos);
                            console.log("Distancia: ", datos.rows[0].elements[0].distance.text);
                            let distancia_km = datos.rows[0].elements[0].distance.text.replace(".", "");

                            let pais_origen = datos.origin_addresses[0].split(","),
                                pais_destino = datos.destination_addresses[0].split(","),
                                primer_pais,
                                segundo_pais;

                            if (pais_origen.length == 3) {
                                primer_pais = pais_origen[2].trim();
                            }
                            if (pais_origen.length == 2) {
                                primer_pais = pais_origen[1].trim();
                            }
                            if (pais_destino.length == 3) {
                                segundo_pais = pais_destino[2].trim();
                            }
                            if (pais_destino.length == 2) {
                                segundo_pais = pais_destino[1].trim();
                            }
                            if (primer_pais == 'Argentina' && segundo_pais == 'Argentina') {
                                if (peso_total_kg != 0) {
                                    let valor = (parseInt(peso_total_kg.value, 10) * valor_unit_kg) + (valor_km_recorrido * parseInt(distancia_km, 10));
                                    input_valor_carga.value = parseInt(valor, 10);
                                    console.log(parseInt(distancia_km, 10));
                                    console.log("typeof", typeof valor_unit_kg);
                                    console.log("peso_total_kg.value", parseInt(peso_total_kg.value, 10), "valor_unit_kg", valor_unit_kg, "valor_km_recorrido", valor_km_recorrido);
                                }
                                if (peso_total_tn != 0) {
                                    let valor = peso_total_tn.value * valor_unit_tn + valor_km_recorrido * parseInt(distancia_km, 10);
                                    input_valor_carga.value = valor;
                                }
                                if (cant_litros != 0) {
                                    let valor = cant_litros.value * valor_litro + valor_km_recorrido * parseInt(distancia_km, 10);
                                    input_valor_carga.value = valor;
                                }



                            } else {
                                alert("¡Ha ingresado Localidades Fuera de Argentina!")
                            }
                        })
                        .catch(function(error) {
                            console.log(error);
                            alert("¡Datos Incorrectos/Incompletos!")
                                //location.reload()
                        });
                }

            }
        })
    </script>


</body>

</html>